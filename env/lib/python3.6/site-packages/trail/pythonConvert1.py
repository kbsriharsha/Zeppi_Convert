import sys
import os
import json
import argparse
import codecs

# Getting the input and output file locations from the command line
parser = argparse.ArgumentParser(description = 'Type your input and output file locations')
parser.add_argument('-i', \
                    dest = 'in_file', \
                    required = True, \
                    help='input file (.json format)')
parser.add_argument('-o', \
                    dest = 'out_file', \
                    required = False, \
                    help='Output file location')
parser.add_argument('-int', \
                    dest = 'interpreter', \
                    required = False, \
                    help='Type the particular interpreter')

args = parser.parse_args()
print(args.in_file)
print(args.out_file)
print(args.interpreter)

input_filename = args.in_file
output_filename = args.out_file
interpreter = args.interpreter

# Verifying the input file locations
try:
    os.path.exists(input_filename)
except:
    print("Please check input file location")
    sys.exit()

try:
    zeppi_ntbk = json.load(codecs.open(args.in_file, 'r', 'utf-8-sig'))
except ValueError:
    print('ERROR: Invalid JSON')
    sys.exit(1)

# Developing for Python:
def zeppi_all(text):
    py_scrt = []
    try:
        for i in zeppi_ntbk['paragraphs']:
            pgm = i["text"].splitlines()
            ident = pgm[0]
            code = pgm[1:]
            if ('%' in ident):
                pgm = '\n'.join(code)
                py_scrt.append(pgm)
            else:
                pgm = '\n'.join(pgm)
                py_scrt.append(pgm)
        final_python = '\n\n'.join(py_scrt)
    except ValueError:
        print('ERROR: Wrong file format')
        sys.exit(1)
    return final_python

# Saving back to file
def sav_file(text, outfile = None):
    if outfile is None:
        outfile = "zeppiconvert.txt"
    try:
        with open(outfile, 'w') as output_file:
            output_file.write(text)
    except ValueError:
        print('Error Opening the output File')
        sys.exit(1)
    return True

# Parsing the json script depending on the interpreter argument
if interpreter == None:
    text = zeppi_all(input_filename)
    print(text)
    save = sav_file(text, output_filename)

print("done")
